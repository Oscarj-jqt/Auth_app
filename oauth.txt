notes 
se connecter à github/settings/developers
faire une app qui accède à github et réalise des actions (profils, reposiotories)
sans connaitre mot de passe
composition en 3 parties, en routes (/login, /callback, /protected route)

Identification
Authentification (token, empreinte)
Autorisation (droits associés à un profil donné)
github paramètre pour config l'app 
avoir l'architecture avant (routes)
-> url https://localhost/public/oauth/public/index.php
https://localhost/public/oauth/public/index.php

le client ID (information) pour obtenir la clé d'autorisation


74048e5859c380c9e5e6eedc9558e8d75887e2cb pour obtenir le jeton d'accès


Exercice GitHub application oauth


Créer app sur Github
Créer un processus pour obtenir l'autorisation de faire des choses sur le compte GitHub
-> obtenir l'autorisation de GitHub
-> obtenir un jeton d'accès + un jeton de rafraîchissement (fait par github)
-> afficher les données du profil utiilisateur

Points d'accès 
- Autorisation : https://github.com/login/oauth/authorize?client_id=<?= 
$_ENV[GITHUB_CLIENT_ID'] ?>&scope=user:read"

    - éventuellement ajouter un 'state' pour mieux protéger la requête
    - Obtenir le jeton d'accès : https://github.com/login/oauth/access_token

    Explique moi le principe, là j'ai déjà créé l'app OAth GitHub (capture) ainsi que le 
    jeton token (classic) il me demande d'établir le scope donc la portée d'action à laquelle 
    le jeton donnera accès n'est-ce aps ?
    Ensuite il faudra faire une application php pour gérer cela faisons un plan de conception.


#Authentification 2FA

Objectif 
- L'utilisateur doit pouvoir s'identifier et rester reconnu par l'application avec des jetons JWT

1 . L'utilisateur s'identifie avec son mot de passe 
2. On demande à l'utilisateur de confirmer son identité
 - Il peut choisir entre : 
 - recevoir un mail
 - recevoir un SMS (Twilio)
 - scanner un QR code (TOTP)
    - Google Authentificator
    - TOTP Authentificator

 3. Autoriser l'utilisateur à accéder à certaines ressources

 Découpage en étapes
1. Authentification OAuth
/login : Redirige vers GitHub OAuth.
/callback : Récupère code, échange contre token, récupère profil.
2. Authentification 2FA
/2fa_select : Propose le choix du facteur (mail, SMS, TOTP)
/2fa_send : Envoie le code ou affiche le QR code
/2fa_verify : Vérifie le code entré par l’utilisateur
3. Autorisation et accès
Génère un JWT si 2FA OK
/protected : Accès aux ressources protégées si JWT valide
4. Déconnexion
/logout : Invalide le JWT

 Ressources nécessaires
Librairie JWT (ex : firebase/php-jwt)
Librairie TOTP/QR code (ex : spomky-labs/otphp, endroid/qr-code)
Service email (PHPMailer ou autre)
Service SMS (Twilio)
Librairie HTTP client (ex : Guzzle pour les requêtes vers GitHub)

procédons à des tests pour vérifier si ce qu'on a fonctionne déjà , aussi je vois plein de clé dans config.php que faut il créer dans le .env, installer comme bibliothèque (firebase phpmailer, twiolio donne moi les commandes) et/ou s'assurer d'avoir dans GitHub, twilio ...


feat: add JSON user repo, JWT and 2FA services; persist user in callback and protect route

Si tu n’as pas envie de gérer la paperasserie du Bundle pour tester, tu peux laisser le système SMS en place dans ton code (pour la structure), mais ne pas le tester.
Tu peux utiliser uniquement l’email (PHPMailer) pour le 2FA dans ton exercice, c’est largement suffisant pour la validation du projet et la logique.
7. Tests manuels à faire
Accéder à /login.php → Redirection GitHub
Autoriser l’application → Retourne sur /callback.php, vérifie les données
Consulter /protected.php sans JWT → Refusé
Consulter /protected.php avec JWT en session → Accès OK




use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;

$mail = new PHPMailer(true);
try {
    $mail->setFrom('noreply@tondomaine.com', 'MonApp');
    $mail->addAddress($userEmail); // $userEmail = destinataire
    $mail->Subject = 'Votre code 2FA';
    $mail->Body = "Votre code de vérification : $code"; // $code = ton code généré
    $mail->send();
} catch (Exception $e) {
    // Gérer l’erreur
}